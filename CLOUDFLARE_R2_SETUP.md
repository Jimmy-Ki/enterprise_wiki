# Cloudflare R2 å­˜å‚¨é…ç½®å®Œæˆ

âœ… **é…ç½®çŠ¶æ€**: å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡

## ğŸ“‹ é…ç½®ä¿¡æ¯

- **Endpoint**: `https://d6351223f25a973eb4483061717a5ab5.r2.cloudflarestorage.com`
- **å­˜å‚¨æ¡¶**: `wiki`
- **CDNåŸŸå**: `https://wiki.jimmyki.com`
- **åŒºåŸŸ**: `auto`
- **è®¿é—®çŠ¶æ€**: âœ… å·²éªŒè¯

## ğŸ”§ é…ç½®æ–‡ä»¶ä½ç½®

é…ç½®å·²å†™å…¥: `.env` æ–‡ä»¶
```bash
STORAGE_TYPE=s3
S3_ENDPOINT_URL=https://d6351223f25a973eb4483061717a5ab5.r2.cloudflarestorage.com
S3_ACCESS_KEY=b633f6f8921fff64173ddda837b54326
S3_SECRET_KEY=d78bac83cad90f73cfaca57b1e1e364e7d4f72008703edfd37577ca972cef6cf
S3_BUCKET_NAME=wiki
S3_REGION=auto
S3_CDN_URL=https://wiki.jimmyki.com
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å¯åŠ¨åº”ç”¨
```bash
python run.py
```

### 2. ä¸Šä¼ æ–‡ä»¶
ç°åœ¨æ‰€æœ‰æ–‡ä»¶ä¸Šä¼ å°†è‡ªåŠ¨ä½¿ç”¨ Cloudflare R2 å­˜å‚¨ï¼š
- æ–‡ä»¶å°†è¢«ä¸Šä¼ åˆ° `https://d6351223f25a973eb4483061717a5ab5.r2.cloudflarestorage.com/wiki/`
- è®¿é—®URLå°†ä½¿ç”¨CDNåŸŸå: `https://wiki.jimmyki.com/`

### 3. æ–‡ä»¶ç»„ç»‡ç»“æ„
```
wiki/
â”œâ”€â”€ attachments/          # é™„ä»¶æ–‡ä»¶
â”‚   â”œâ”€â”€ 20240101_120000_document.pdf
â”‚   â””â”€â”€ 20240101_120500_image.jpg
â”œâ”€â”€ avatars/             # ç”¨æˆ·å¤´åƒ
â”œâ”€â”€ exports/             # å¯¼å‡ºæ–‡ä»¶
â””â”€â”€ temp/                # ä¸´æ—¶æ–‡ä»¶
```

## ğŸ”’ å®‰å…¨æç¤º

1. **ä¿æŠ¤å¯†é’¥**: ç¡®ä¿ `.env` æ–‡ä»¶ä¸è¢«æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿ
2. **æƒé™ç®¡ç†**: å®šæœŸæ£€æŸ¥å’Œæ›´æ–°è®¿é—®å¯†é’¥
3. **å¤‡ä»½**: å»ºè®®å®šæœŸå¤‡ä»½å­˜å‚¨æ¡¶ä¸­çš„é‡è¦æ–‡ä»¶

## ğŸ“Š ç›‘æ§å’Œç®¡ç†

### Cloudflare R2 Dashboard
1. ç™»å½• [Cloudflare Dashboard](https://dash.cloudflare.com/)
2. è¿›å…¥ R2 Object Storage
3. æŸ¥çœ‹å­˜å‚¨ä½¿ç”¨æƒ…å†µã€è®¿é—®ç»Ÿè®¡ç­‰

### æŸ¥çœ‹å­˜å‚¨å†…å®¹
```python
from app.services.storage_service import create_storage_service
from app import create_app

app = create_app()
with app.app_context():
    storage = create_storage_service(app.config['STORAGE_CONFIG'])
    # å¯ä»¥é€šè¿‡ storage.backend.s3_client è¿›è¡ŒS3æ“ä½œ
```

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜
1. **ä¸Šä¼ å¤±è´¥**: æ£€æŸ¥å­˜å‚¨æ¡¶æƒé™å’Œè®¿é—®å¯†é’¥
2. **CDNè®¿é—®å¤±è´¥**: ç¡®è®¤CDNåŸŸåå·²æ­£ç¡®é…ç½®æŒ‡å‘R2
3. **403é”™è¯¯**: æ£€æŸ¥CORSè®¾ç½®å’Œè®¿é—®æƒé™

### æµ‹è¯•è¿æ¥
è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é…ç½®ï¼š
```bash
python3 simple_storage_test.py
```

## ğŸ“ˆ ä¼˜åŒ–å»ºè®®

1. **CORSé…ç½®**: åœ¨R2å­˜å‚¨æ¡¶ä¸­é…ç½®é€‚å½“çš„CORSè§„åˆ™
2. **ç¼“å­˜ç­–ç•¥**: ä¸ºä¸åŒç±»å‹æ–‡ä»¶è®¾ç½®åˆé€‚çš„ç¼“å­˜å¤´
3. **å‹ç¼©**: å¯¹å›¾ç‰‡ç­‰æ–‡ä»¶è¿›è¡Œå‹ç¼©ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´
4. **ç”Ÿå‘½å‘¨æœŸç®¡ç†**: è®¾ç½®è‡ªåŠ¨åˆ é™¤è¿‡æœŸçš„ä¸´æ—¶æ–‡ä»¶

## ğŸ”„ è¿ç§»ç°æœ‰æ–‡ä»¶

å¦‚æœéœ€è¦ä»æœ¬åœ°å­˜å‚¨è¿ç§»åˆ°R2ï¼š

1. å¤‡ä»½ç°æœ‰æ–‡ä»¶
2. è¿è¡Œè¿ç§»è„šæœ¬ï¼ˆå‚è€ƒ `docs/storage_setup.md` ä¸­çš„è¿ç§»æŒ‡å—ï¼‰
3. éªŒè¯æ–‡ä»¶å®Œæ•´æ€§

---

**âœ¨ é…ç½®å®Œæˆï¼ç°åœ¨ä½ çš„ä¼ä¸šWikiå°†ä½¿ç”¨é«˜æ€§èƒ½çš„Cloudflare R2å­˜å‚¨æœåŠ¡ã€‚**