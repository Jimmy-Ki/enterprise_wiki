{% extends "admin/admin_base_standalone.html" %}

{% block title %}系统概览 - 管理控制台{% endblock %}

{% set page_title = "系统概览" %}
{% set page_subtitle = "系统运行状态和数据统计" %}
{% set page_icon = "fas fa-tachometer-alt" %}

{% block admin_content %}
<!-- 系统统计卡片 -->
<div class="admin-stats-grid">
    <div class="admin-stat-card">
        <div class="admin-stat-number">{{ stats.total_users }}</div>
        <div class="admin-stat-label">总用户数</div>
        <div class="admin-stat-meta">
            <i class="fas fa-user-check" style="color: var(--admin-success);"></i>
            {{ stats.active_users }} 个活跃用户
        </div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-number">{{ stats.total_pages }}</div>
        <div class="admin-stat-label">总页面数</div>
        <div class="admin-stat-meta">
            <i class="fas fa-check-circle" style="color: var(--admin-success);"></i>
            {{ stats.published_pages }} 个已发布
        </div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-number">{{ stats.total_categories }}</div>
        <div class="admin-stat-label">分类数量</div>
        <div class="admin-stat-meta">
            <i class="fas fa-folder-open" style="color: var(--admin-info);"></i>
            内容分类管理
        </div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-number">{{ stats.total_attachments }}</div>
        <div class="admin-stat-label">附件数量</div>
        <div class="admin-stat-meta">
            <i class="fas fa-paperclip" style="color: var(--admin-warning);"></i>
            文件存储管理
        </div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-number">{{ stats.active_sessions }}</div>
        <div class="admin-stat-label">活跃会话</div>
        <div class="admin-stat-meta">
            <i class="fas fa-signal" style="color: var(--admin-success);"></i>
            实时在线用户
        </div>
    </div>

    <div class="admin-stat-card">
        <div class="admin-stat-number">正常</div>
        <div class="admin-stat-label">系统状态</div>
        <div class="admin-stat-meta">
            <i class="fas fa-heartbeat" style="color: var(--admin-success);"></i>
            所有服务运行正常
        </div>
    </div>
</div>

<!-- 最近活动 -->
<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 24px; margin-bottom: 32px;">
    <div class="admin-card">
        <div class="admin-card-header">
            <h5 class="admin-card-title">
                <i class="fas fa-clock"></i>
                最近更新页面
            </h5>
        </div>
        <div class="admin-card-body">
            {% if recent_pages %}
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>页面标题</th>
                            <th>作者</th>
                            <th>更新时间</th>
                            <th>状态</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for page in recent_pages %}
                        <tr>
                            <td>
                                <a href="{{ url_for('wiki.view_page', slug=page.slug) }}"
                                   class="text-decoration-none" target="_blank">
                                    {{ page.title }}
                                </a>
                            </td>
                            <td>{{ page.author.username if page.author else '未知' }}</td>
                            <td>{{ page.updated_at.strftime('%Y-%m-%d %H:%M') }}</td>
                            <td>
                                {% if page.is_published %}
                                <span class="admin-badge success">已发布</span>
                                {% else %}
                                <span class="admin-badge warning">草稿</span>
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="admin-empty-state">
                <i class="fas fa-file-alt"></i>
                <h5>暂无最近页面</h5>
                <p>系统中还没有页面更新记录</p>
                <a href="{{ url_for('admin.pages') }}" class="admin-btn primary">
                    <i class="fas fa-plus me-2"></i>创建页面
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <div class="admin-card">
        <div class="admin-card-header">
            <h5 class="admin-card-title">
                <i class="fas fa-user-plus"></i>
                新注册用户
            </h5>
        </div>
        <div class="admin-card-body">
            {% if recent_users %}
            {% for user in recent_users %}
            <div style="display: flex; align-items: center; justify-content: space-between;
                       padding: 12px 0; border-bottom: 1px solid var(--admin-border);">
                <div style="display: flex; align-items: center;">
                    <img src="{{ user.gravatar(32) }}" alt="Avatar"
                         style="width: 32px; height: 32px; border-radius: 50%; margin-right: 12px;">
                    <div>
                        <div style="font-weight: 500; color: var(--admin-text);">{{ user.username }}</div>
                        <div style="font-size: 12px; color: var(--admin-text-secondary);">{{ user.email }}</div>
                    </div>
                </div>
                <div style="text-align: right;">
                    {% if user.is_active %}
                    <span class="admin-badge success">活跃</span>
                    {% else %}
                    <span class="admin-badge danger">未激活</span>
                    {% endif %}
                    <div style="font-size: 11px; color: var(--admin-text-secondary); margin-top: 4px;">
                        {{ user.member_since.strftime('%m-%d') }}
                    </div>
                </div>
            </div>
            {% endfor %}
            {% else %}
            <div class="admin-empty-state">
                <i class="fas fa-users"></i>
                <h5>暂无新用户</h5>
                <p>最近没有新用户注册</p>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- 快捷操作 -->
<div class="admin-card">
    <div class="admin-card-header">
        <h5 class="admin-card-title">
            <i class="fas fa-bolt"></i>
            快捷操作
        </h5>
    </div>
    <div class="admin-card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
            <a href="{{ url_for('admin.create_user') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-user-plus fa-2x mb-2 d-block"></i>
                创建用户
            </a>
            <a href="{{ url_for('admin.create_category') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-folder-plus fa-2x mb-2 d-block"></i>
                创建分类
            </a>
            <a href="{{ url_for('wiki.create_page') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-file-plus fa-2x mb-2 d-block"></i>
                创建页面
            </a>
            <a href="{{ url_for('admin.sessions') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-desktop fa-2x mb-2 d-block"></i>
                管理会话
            </a>
            <a href="{{ url_for('admin.settings') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-cog fa-2x mb-2 d-block"></i>
                系统设置
            </a>
            <a href="{{ url_for('admin.backup') }}" class="admin-btn" style="padding: 16px; text-align: center;">
                <i class="fas fa-database fa-2x mb-2 d-block"></i>
                数据备份
            </a>
        </div>
    </div>
</div>

<!-- 系统状态监控 -->
<div class="admin-card">
    <div class="admin-card-header">
        <h5 class="admin-card-title">
            <i class="fas fa-heartbeat"></i>
            系统状态监控
        </h5>
    </div>
    <div class="admin-card-body">
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 24px;">
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-database fa-3x" style="color: var(--admin-success); margin-bottom: 12px;"></i>
                <h6>数据库</h6>
                <span class="admin-badge success">运行正常</span>
                <div style="font-size: 12px; color: var(--admin-text-secondary); margin-top: 8px;">
                    SQLite · 响应时间 2ms
                </div>
            </div>
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-memory fa-3x" style="color: var(--admin-info); margin-bottom: 12px;"></i>
                <h6>内存使用</h6>
                <span class="admin-badge info">正常</span>
                <div style="font-size: 12px; color: var(--admin-text-secondary); margin-top: 8px;">
                    45% 使用率 · 2.2GB/5GB
                </div>
            </div>
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-hdd fa-3x" style="color: var(--admin-warning); margin-bottom: 12px;"></i>
                <h6>磁盘空间</h6>
                <span class="admin-badge warning">需要注意</span>
                <div style="font-size: 12px; color: var(--admin-text-secondary); margin-top: 8px;">
                    78% 已使用 · 建议清理
                </div>
            </div>
            <div style="text-align: center; padding: 20px;">
                <i class="fas fa-network-wired fa-3x" style="color: var(--admin-success); margin-bottom: 12px;"></i>
                <h6>网络连接</h6>
                <span class="admin-badge success">良好</span>
                <div style="font-size: 12px; color: var(--admin-text-secondary); margin-top: 8px;">
                    延迟正常 · 带宽充足
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // 简单的页面加载完成提示
    console.log('Admin dashboard loaded successfully');
});
</script>
{% endblock %}